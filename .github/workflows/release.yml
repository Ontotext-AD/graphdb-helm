name: Release GraphDB Helm chart on GitHub Pages

on:
  push:
    tags:
      - "v*"
  workflow_dispatch:
    inputs:
      ref:
        description: "Git ref to release from (existing tag, branch, or SHA). Leave blank to use the ref you selected in the UI."
        required: false
        default: ""

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - id: checkout_repository
        name: Checkout
        # actions/checkout@v4.1.1
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11
        with:
          fetch-depth: 0
          ref: ${{ github.event.inputs.ref || github.ref }}

      - id: configure_git
        name: Configure Git identity
        run: |
          git config user.name "$GITHUB_ACTOR"
          git config user.email "$GITHUB_ACTOR@users.noreply.github.com"

      - id: chart_releaser
        name: Run chart-releaser
        # helm/chart-releaser-action@v1.7.0
        uses: helm/chart-releaser-action@cae68fefc6b5f367a0275617c9f83181ba54714f
        with:
          charts_dir: ./
        env:
          CR_TOKEN: ${{ secrets.GITHUB_TOKEN }}
