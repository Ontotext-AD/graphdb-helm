{{- if not (hasKey $.Values.graphdb.node.persistence "volumeClaimTemplateSpec") }}
{{- $storageClassName := $.Values.graphdb.node.persistence.storageClassName | default $.Values.global.storageClass }}
{{- if or (ne $storageClassName "standard") (ne $storageClassName "") }}
{{- if eq .Values.graphdb.node.persistence.volumeNamePrefix "graphdb-default-node" }}
{{- range $i, $node_index := untilStep 1 (add1 (int $.Values.graphdb.clusterConfig.nodesCount) ) 1 }}
#
# Default persistence volume for GraphDB workers. Data is stored on the node file system. Suitable
# for Minikube deployments.
#
# Note: Not to be used in production or multi node cluster.
#
---
apiVersion: {{ $.Values.versions.pv }}
kind: PersistentVolume
metadata:
  name: {{ $.Release.Namespace }}-graphdb-default-node-{{ $node_index }}-pv
  labels:
    name: {{ $.Release.Namespace }}-graphdb-default-node-{{ $node_index }}-pv
spec:
  claimRef:
    name: graphdb-node-{{ $node_index }}-data-pvc
    namespace: {{ $.Release.Namespace }}
  storageClassName: {{ $storageClassName }}
  accessModes:
    - ReadWriteOnce
  capacity:
    storage: {{ $.Values.graphdb.node.persistence.storage }}
  hostPath:
    path: {{ $.Values.deployment.storage }}/graphdb-node-{{ $node_index }}-data

{{- end }}
{{- end }}
{{- end }}
{{- end }}
